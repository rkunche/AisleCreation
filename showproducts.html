<html>
    <head>
        <script>
//            (function(i, s, o, g, r, a, m) {
//                i['GoogleAnalyticsObject'] = r;
//                i[r] = i[r] || function() {
//                    (i[r].q = i[r].q || []).push(arguments)
//                }, i[r].l = 1 * new Date();
//                a = s.createElement(o),
//                        m = s.getElementsByTagName(o)[0];
//                a.async = 1;
//                a.src = g;
//                m.parentNode.insertBefore(a, m)
//            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
//
//            ga('create', 'UA-55582645-2', 'auto');
//            ga('create', 'UA-55582645-2', {'userId': userId});
//            ga('send', 'pageview');
//
//        </script>
        <meta charset="utf-8">

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>

        <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
        <script src="jquery.bxslider.js"></script>
        <link href="jquery.bxslider.css" rel="stylesheet" /> 

        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.css" />
        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.filter.css" />
        <link rel="stylesheet" type="text/css" href="assets/style.css" />
        <link rel="stylesheet" type="text/css" href="assets/prettify.css" />
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/ui-lightness/jquery-ui.css" />
        <!--        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>-->
        <script type="text/javascript" src="jquery.csv-0.71.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.filter.js"></script>
        <script type="text/javascript" src="assets/prettify.js"></script> 



        <script src="uploadTask.js" type="text/javascript"></script>
        <script>
            var tagsrequest;
            var stateValue = 'CURATED';
            var offset = 0;
            var limit = 20;
            var aisleOwnerName = "Anonymous";
            var request;
            var newheight;

            var userId;
            var category;
            var occasion;
            var lookingFor;
            var productType;
            var aisleOwnerName;
            var uploadProductCount = 0;
            var aisleCount = 0;
            var lookingForTag;
            var titleTags = [];
            var selectedWord;
            var itemArray = [];
            var subItem = [];
            var aisleTitle;
            var titleWord;
            //prototype for clear the array values.
            Array.prototype.clear = function() {
                this.length = 0;
            };
            window.onmessage = function(e) {
                var data = e.data.split("#");
                if (data[0] === 'getSelectedProducts') {
                    getSelectedProducts();

                    if (selectedProducts.length > 0) {
                        for (var i = 0; i < selectedProducts.length; i++) {
                            var productString = JSON.stringify(selectedProducts[i]);
                            window.top.postMessage(productString, '*');
                        }
                        window.top.postMessage('done', '*');
                    }
                }
                if (data[0] === 'getproducts') {

                    getCrawledProducts(data[1], data[2], data[3], data[4]);
                }
                if (data[0] === 'getAllAisles') {
                    getAllAislesByUser(data[1]);
                }
                if (data[0] == 'clearProducsts') {
                    crearPorducts();
                }
                if (data[0] === 'User') {

                    if (data[1] !== '0') {
                        (function(i, s, o, g, r, a, m) {
                            i['GoogleAnalyticsObject'] = r;
                            i[r] = i[r] || function() {
                                (i[r].q = i[r].q || []).push(arguments)
                            }, i[r].l = 1 * new Date();
                            a = s.createElement(o),
                                    m = s.getElementsByTagName(o)[0];
                            a.async = 1;
                            a.src = g;
                            m.parentNode.insertBefore(a, m)
                        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

                        // ga('create', 'UA-55582645-2', 'auto');
                        ga('create', 'UA-55582645-2', {'userId': data[1]});
                        ga('send', 'pageview');
                        getUser(data[1]);
                        // getUser("6419807607980032");
                    }

                }
            };
        </script>


        <script>

            function getTags() {
                document.getElementById('products_holder_id').setAttribute("style", "width:800px");
                document.getElementById('aisle_holder_id').setAttribute("style", "width:800px");
                newheight = screen.height - 120;
                getMe();
                var fetchButton = document.getElementById("fetch_button_id");
                fetchButton.style.backgroundColor = "white";
                fetchButton.style.color = "green";
                fetchButton.style.outline = "solid orange";
                  var fetchButton_occasion = document.getElementById("fetch_button_id_occasion");
                 fetchButton_occasion.style.backgroundColor = "white";
                 fetchButton_occasion.style.color = "green";
                 fetchButton_occasion.style.outline = "solid orange";
                var url = "https://vue-server-dev.appspot.com/api/producttags/all";
                if (XMLHttpRequest)
                {
                    tagsrequest = new XMLHttpRequest();
                    if ("withCredentials" in tagsrequest)
                    {
                        // Firefox 3.5 and Safari 4
                        tagsrequest.open('GET', url, true);
                        tagsrequest.onreadystatechange = tagRespnseHandler;
                        tagsrequest.send();
                    }
                }
                document.getElementById("btTagOne").style.color = "black";
                document.getElementById("btTagTwo").style.color = "black";
                document.getElementById("btTagThree").style.color = "black";
                document.getElementById("btTagFour").style.color = "black";
                document.getElementById("btTagFive").style.color = "black";
                document.getElementById("btTagSix").style.color = "black";

                document.getElementById("btTagTwo").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagTwo").onmouseout = function()
                {
                    this.style.color = "black";
                }


                document.getElementById("btTagOne").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagOne").onmouseout = function()
                {
                    this.style.color = "black";
                }


                document.getElementById("btTagThree").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagThree").onmouseout = function()
                {
                    this.style.color = "black";
                }
                document.getElementById("btTagFour").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagFour").onmouseout = function()
                {
                    this.style.color = "black";
                }
                document.getElementById("btTagFive").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagFive").onmouseout = function()
                {
                    this.style.color = "black";
                }
                document.getElementById("btTagSix").onmouseover = function()
                {
                    this.style.color = "green";
                }

                document.getElementById("btTagSix").onmouseout = function()
                {
                    this.style.color = "black";
                }

            }
            function tagRespnseHandler() {
                if (tagsrequest.readyState !== 4)
                    return;
                if (tagsrequest.status === 200)
                {

                    var tagString = tagsrequest.responseText;
                    var jsonResponse = JSON.parse(tagString);
                    var blocked = [];
                    console.log("tags are downloaded " + jsonResponse.length);
                    for (var k = 0; k < jsonResponse.length; k++) {
                        var tagObject = jsonResponse[k];
                        if (tagObject.tagString.charAt(0) === tagObject.tagString.charAt(0).toLowerCase()) {
                            console.log(tagObject.tagString + " length : " + tagObject.tagString.length);
                            blocked.push(tagObject);
                        }
                    }
                    for (var i = 0; i < blocked.length; i++) {

                        var t = jsonResponse.indexOf(blocked[i]);
                        if (t !== -1) {
                            jsonResponse.splice(t, 1);
                        }
                    }
                    var productType = document.getElementById('productType_tag');
                    var occasionSubCatelement = document.getElementById('Occassion_tag');
                    var lookingForSubCatelement = document.getElementById('LookingFor_tag');
                    //document.getElementById("stateId").value = stateValue;
                    //var temp2 = tag_string_array[static_categoryNames[k]];
                    //  tagSubCatelement.options[tagSubCatelement.options.length] = new Option('', '', false, false);
                    for (var i = 0; i < jsonResponse.length; i++) {

                        // tagSubCatelement.options[tagSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        if (jsonResponse[i].tagCategory === "Occasion") {
                            occasionSubCatelement.options[occasionSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }

                        if (jsonResponse[i].tagCategory === "Product Type") {
                            lookingForSubCatelement.options[lookingForSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                            productType.options[productType.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }
                    }
                    ajaxcallToPType('OccasionsCuration.csv', titleTags);
                    $("#Occassion_tag").multiselect({
                        multiple: false,
                        header: "Occasion",
                        noneSelectedText: "Occasion",
                        selectedList: 1
                    }).multiselectfilter();
                    $("#LookingFor_tag").multiselect({
                        multiple: false,
                        header: "Product Type",
                        noneSelectedText: "Product Type",
                        selectedList: 1
                    }).multiselectfilter();
                    $("#productType_tag").multiselect({
                        multiple: false,
                        header: "Product Type",
                        noneSelectedText: "Product Type",
                        selectedList: 1
                    }).multiselectfilter();

                    $(function() {
                        var warning = $(".message");

                        $("select").multiselect({
                            header: "Choose only TWO items!",
                            click: function(e) {

                                if ($(this).multiselect("widget").find("input:checked").length > 1) {
                                    warning.addClass("error").removeClass("success").html("You can only check one checkboxe!");
                                    alert("cant select more than one value");
                                    return false;
                                } else {
                                    warning.addClass("success").removeClass("error").html("Check a few boxes.");
                                }

                            }
                        });
                    });

                }
                if (tagsrequest.status !== 200 && tagsrequest.status !== 304) {
                    alert('HTTP GET error ' + tagsrequest.status);
                    return;
                }
            }
            function occasionSelectionVal() {
                        document.getElementById('fetch_button_id').style.visibility="hidden";
                document.getElementById('fetch_button_id_occasion').style.visibility="visible";
               
                var selectedValue = $("#Occassion_tag").val();
                document.getElementById("titleID").value = "selectedValue";
                $('#titleID').multiselect('refresh');
                aisleTitle = null;
                productType = '';
                occasion = selectedValue;
                titleWord = null;
                
                document.getElementById("productType_tag").value = "selectedValue";
                $('#productType_tag').multiselect('refresh');
                ga('send', 'event', 'option', 'select', selectedValue);
                
                document.getElementById("Occassion_tag").value = selectedValue;
                document.getElementById('fetch_button_id').value = "Fetch";

                document.getElementById('btTagOne').innerHTML = " ";

                document.getElementById('btTagTwo').innerHTML = " ";

                document.getElementById('btTagThree').innerHTML = " ";


                document.getElementById('btTagFour').innerHTML = " ";

                document.getElementById('btTagFive').innerHTML = " ";

                document.getElementById('btTagSix').innerHTML = " ";

            }
            function lookingForSelectionVal() {
                  document.getElementById('fetch_button_id').style.visibility="hidden";
                document.getElementById('fetch_button_id_occasion').style.visibility="visible";
                productType = '';
                titleWord = null
                var selectedValue = $("#LookingFor_tag").val();
                document.getElementById("titleID").value = "selectedValue";
                $('#titleID').multiselect('refresh');
                aisleTitle = null;
                document.getElementById("productType_tag").value = "selectedValue";
                $('#productType_tag').multiselect('refresh');
                lookingFor = selectedValue;
                ga('send', 'event', 'option', 'select', selectedValue);
                document.getElementById('btTagOne').innerHTML = " ";

                document.getElementById('btTagTwo').innerHTML = " ";

                document.getElementById('btTagThree').innerHTML = " ";


                document.getElementById('btTagFour').innerHTML = " ";

                document.getElementById('btTagFive').innerHTML = " ";

                document.getElementById('btTagSix').innerHTML = " ";
                //document.getElementById("LookingFor_tag").value = selectedValue;
            }
            function productTypeTag() {
                var selectedValue = $("#productType_tag").val();
                 document.getElementById('fetch_button_id_occasion').style.visibility="hidden";
                 document.getElementById('fetch_button_id').style.visibility="visible";
                document.getElementById("titleID").value = "selectedValue";
                $('#titleID').multiselect('refresh');
                aisleTitle = null;
                lookingFor = '';
                occasion = '';
                titleWord = null;
                productType = selectedValue;
                document.getElementById("LookingFor_tag").value = "selectedValue";
                document.getElementById("Occassion_tag").value = "selectedValue";

                $('#LookingFor_tag').multiselect('refresh');
                $('#Occassion_tag').multiselect('refresh');




                ga('send', 'event', 'option', 'select', selectedValue);
                document.getElementById('btTagOne').innerHTML = " ";

                document.getElementById('btTagTwo').innerHTML = " ";

                document.getElementById('btTagThree').innerHTML = " ";


                document.getElementById('btTagFour').innerHTML = " ";

                document.getElementById('btTagFive').innerHTML = " ";

                document.getElementById('btTagSix').innerHTML = " ";
            }
            function onTitleSelectionChange() {
                document.getElementById('fetch_button_id_occasion').style.visibility="hidden";
                document.getElementById('fetch_button_id').style.visibility="visible";
                var selectedValue = $("#titleID").val();
                var position;
                aisleTitle = selectedValue;
                document.getElementById("LookingFor_tag").value = "selectedValue";
                document.getElementById("Occassion_tag").value = "selectedValue";
                document.getElementById("productType_tag").value = "selectedValue";
                $('#LookingFor_tag').multiselect('refresh');
                $('#Occassion_tag').multiselect('refresh');
                $('#productType_tag').multiselect('refresh');
                for (var i = 0; i < itemArray.length; i++) {
                    console.log("TAGING: itemArray length " + itemArray[i].title.split(":")[0]);
                    console.log("TAGING: itemArray length " + itemArray[i].title.split(":")[1]);
                    if (itemArray[i].title.split(":")[1].localeCompare(selectedValue) === 0) {
                        position = i;
                        console.log("TAGING: position is " + position);
                        break;
                    }
//                    if(itemArray[i].title.split(":")[1] === selectedValue){
//                        position = i;
//                        console.log("TAGING: position is "+position);
//                        break;
//                    }
                }
                var wordbtnOne = document.getElementById('btTagOne');
                var wordbtnTwo = document.getElementById('btTagTwo');
                var wordbtnThree = document.getElementById('btTagThree');
                var wordbtnFour = document.getElementById('btTagFour');
                var wordbtnFive = document.getElementById('btTagFive');
                var wordbtnSix = document.getElementById('btTagSix');
                var tagsArray = [];
                if (position !== undefined) {
                    var titleObject = itemArray[position];
                    if (titleObject !== undefined) {
                        console.log("TAGING: title object ");
                        var tags;
                        tags = titleObject.Tags.split(":")[1];
                        console.log("TAGING: title object " + tags);
                        tagsArray = tags.split(";");
                    }
                }
                console.log("TAGING: tags count is " + tagsArray.length);
                if (tagsArray.length >= 1) {

                    document.getElementById("productType_tag").style.visibility = "hidden";
                    console.log("TAGING:  hidding the product selection ");
                }
                if (tagsArray[0] !== undefined) {
                    document.getElementById('btTagOne').innerHTML = tagsArray[0];
                }
                if (tagsArray[1] !== undefined) {
                    document.getElementById('btTagTwo').innerHTML = tagsArray[1];
                }
                if (tagsArray[2] !== undefined) {
                    document.getElementById('btTagThree').innerHTML = tagsArray[2];
                }
                if (tagsArray[3] !== undefined) {
                    document.getElementById('btTagFour').innerHTML = tagsArray[3];
                }
                if (tagsArray[4] !== undefined) {
                    document.getElementById('btTagFive').innerHTML = tagsArray[4];
                }
                if (tagsArray[5] !== undefined) {
                    document.getElementById('btTagSix').innerHTML = tagsArray[5];
                }

                //var wordbtnOne = document.getElementById("titleID").value = selectedValue;



            }
            var titleTag = function(param) {
                if (selectedWord === undefined) {
                    selectedWord = param.innerHTML;
                    offset = 0;
                } else if (selectedWord === param.innerHTML) {
                    offset = offset + limit;
                } else {
                    offset = 0;
                }

                //refresh selectors.
                document.getElementById("LookingFor_tag").value = "selectedValue";
                document.getElementById("Occassion_tag").value = "selectedValue";
                document.getElementById("productType_tag").value = "selectedValue";
                $('#LookingFor_tag').multiselect('refresh');
                $('#Occassion_tag').multiselect('refresh');
                $('#productType_tag').multiselect('refresh');

                var tag = param.innerHTML;
                productType = '';
                occasion = '';
                lookingFor = '';

                 titleWord = tag;
                  document.getElementById('fetch_button_id').value = "Fetch More";
                getCrawledProducts(tag, offset, limit, stateValue);



            }
            function tagSelectionVal() {
                var selectedValue = $("#select_tag").val();
                offset = 0;
                ga('send', 'event', 'option', 'select', selectedValue);
                category = selectedValue;
                document.getElementById('fetch_button_id').value = "Fetch";
                document.getElementById("select_tag").value = selectedValue;
            }
            function getSelectedValue() {
                //  stateValue = $("#stateId").val();
                ga('send', 'event', 'option', 'select', stateValue);
                // document.getElementById('fetch_button_id').value = "Fetch";
                offset = 0;
                // document.getElementById("stateId").value = stateValue;
            }
            function getProductWithOccasion(){
       
                     var searchString;
                    searchString = occasion;
                    if (  searchString === undefined || searchString === '' ) {
                        searchString = lookingFor;
                         
                    }
                
                if (searchString === undefined || searchString === '') {
                    alert("Please Select OccasionTag or Product Type");
                    return;
                } 
                var buttonValue = document.getElementById('fetch_button_id_occasion').value; 
                 if(buttonValue === "Fetch More"){
                      ga('send', 'event', 'button', 'click', 'Fetch More');
                    offset = offset + limit;
                    document.getElementById('fetch_button_id_occasion').value = "Fetch More";
                } else {
                     offset = 0;
                    ga('send', 'event', 'button', 'click', 'Fetch');
                    document.getElementById('fetch_button_id_occasion').value = "Fetch More";
                }
                document.getElementById('fetch_button_id').value = "Fetch";
                getCrawledProducts(searchString, offset, limit, stateValue);
                 
            }
            function getProducts() {
                var searchString;
                if(titleWord !== null){
                    searchString = titleWord;
                }else{
                if (productType === '') {
                    searchString = occasion;
                    if (searchString === '') {
                        searchString = lookingFor;
                    }
                } else {
                    searchString = productType;
                }
               
            }  
             if (searchString === undefined || searchString === '') {
                    alert("Please Select Title or Product Type");
                    return;
                }
                var buttonValue = document.getElementById('fetch_button_id').value;
                if (buttonValue === "Fetch More") {
                    ga('send', 'event', 'button', 'click', 'Fetch More');
                    offset = offset + limit;
                    document.getElementById('fetch_button_id').value = "Fetch More";
                } else {
                    offset = 0;
                    ga('send', 'event', 'button', 'click', 'Fetch');
                    document.getElementById('fetch_button_id').value = "Fetch More";
                }
                document.getElementById('fetch_button_id_occasion').value = "Fetch";
                getCrawledProducts(searchString, offset, limit, stateValue);
            }
            function getUser(id) {
                var url = "https://vue-server-dev.appspot.com/api/user/" + id;
                console.log("user url" + url);
                if (XMLHttpRequest)
                {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request)
                    {
                        // Firefox 3.5 and Safari 4
                        request.open('GET', url, true);
                        request.onreadystatechange = get_handler_aisle;
                        request.send();
                    }
                }
            }
            function get_handler_aisle() {
                if (request.readyState != 4)
                    return;
                if (request.status != 200 && request.status != 304) {
                    alert('User reqeust Error ' + request.status);
                    return;
                }
                if (request.status == 200)
                {
                    var user = JSON.parse(request.responseText);
                    aisleOwnerName = user.firstName + " " + user.lastName;
                    userId = user.id;
                    // ga('create', 'UA-55582645-2', {'userId': userId});
                    //ga('send', 'pageview');
                    // alert('HTTP GET success: ' + urlUserID);

                }

            }

            function getMe() {

                window.top.postMessage('getUser', '*');
            }

            function createAisleRequest() {
               category ="Fashion & Style";
 
                if(lookingFor === undefined || lookingFor === '' || lookingFor.length <= 1){
                    if(productType !== undefined && productType !== '' && productType.length > 1){
                    lookingFor = productType;
                }
                }
               if(aisleTitle === undefined || aisleTitle === '' || aisleTitle.length<= 1){
                   aisleTitle = null;
               }
               if(occasion === undefined || occasion === '' || occasion.length<=1){
                   occasion = null;
               }
                var url = "https://vue-server-dev.appspot.com/api/aisle";
              
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('POST', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = aisle_post_handler;
                        //aisle creation request.
                        request.send(JSON.stringify({id: null, ownerUserId: userId, category: category, description: null, lookingFor: lookingFor, name: aisleTitle, occassion: occasion, currentAisleState: "CURATED", bookmarkCount: 0}));
                    }
                }
            }
            function aisle_post_handler() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status === 200)
                {
                    //get the aisle id and start updating products from here.
                    alert("Curated Successfully " + request.responseText);
                    var jsonObject = JSON.parse(request.responseText);
                    aisleId = jsonObject.id;
                    console.log("aisle Id: " + aisleId);
                    //uploadin aisle products

                    uploadAisleProduct(selectedProducts[uploadProductCount]);

                }

            }
            function uploadAisleProduct(product) {
                var url = "https://vue-server-dev.appspot.com/api/product/" + product.id;
                console.log("url: " + url);
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('PUT', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = update_handler;
                        //product update request:

                        request.send(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                        console.log(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                    }
                }
            }
            function update_handler() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status === 200)
                {
                    //alert("Curated Successfully " + request.responseText);
                    uploadProductCount = uploadProductCount + 1;
                    if (uploadProductCount < selectedProducts.length) {
                        uploadAisleProduct(selectedProducts[uploadProductCount]);
                    } else {
                        alert("Aisle created successfully with  " + uploadProductCount + " products");
                    }
                }

            }
            function ajaxcallToPType(pathOfFileToReadFrom, list) {
                var datatype = '';

                var ajax = $.ajax({
                    url: pathOfFileToReadFrom,
                    async: false,
                    success: function(csvd) {
                        console.log('ajax succes: ' + csvd);
                        datatype = $.csv2Array(csvd);
                        console.log('ajax arry: ' + datatype);

                    },
                    dataType: "text",
                });

                ajax.complete(function(jqXHR) {
                    // console.log('ajax complete ' + datatype);
                    if (jqXHR.readyState === 4) {
                        callfunction(datatype, list);
                    }
                });
            }

            function callfunction(array, list) {

                for (var i = 0; i < array.length; i++) {
                    var tmp = array[i];
                    var line = tmp;
                    for (var j = 0; j < line.length; j++) {
                        v = line[j];
                        v = $.trim(v);
                        if (v !== '' && v.length > 0) {
                            console.log('Words   :' + v + ':');
                            list.push(v);
                        }
                    }
                }



                var titleOBject = {title: "", Tags: ""};
                var tempArray = [];
                var filterArray = [];
                for (var j = 0; j < list.length; j++) {
                    var item = list[j];
                    if (item.length > 4) {
                        item = item.substr(0, 3);
                        if (item === 'Tag') {
                            if (tempArray.length >= 1) {
                                tempArray.push(list[j]);
                                var titleOBject = {title: "", Tags: ""};
                                titleOBject.title = tempArray[0];
                                titleOBject.Tags = tempArray[1];
                                filterArray.push(titleOBject);
                                tempArray.clear();
                            }


                            continue;
                        }
                        item = list[j];
                        item = item.substr(0, 4);
                        if (item === 'Titl') {
                            tempArray.push(list[j]);

                            continue;
                        }
                    }

                }
                itemArray.clear();
                console.log('item array size: ' + itemArray.length);
                console.log('sorted list1: ' + filterArray.length);

                for (var k = 0; k < filterArray.length; k++) {
                    if (filterArray[k].title !== undefined) {
                        itemArray.push(filterArray[k]);

                    }


                }
                filterArray.clear();

                list.sort();
                console.log('sorted list2: ' + itemArray.length);
                for (var i = 0; i < itemArray.length; i++) {
                    var aisleTitleCatelement = document.getElementById('titleID');

                    var title = itemArray[i].title.split(":")[1];
                    aisleTitleCatelement.options[aisleTitleCatelement.options.length] = new Option(title, title, false, false);
                    $("#titleID").multiselect({
                        multiple: false,
                        header: "Select Title",
                        noneSelectedText: "Select Title",
                        selectedList: 1
                    }).multiselectfilter();
                }

            }
        </script>






    </head>

    <body onLoad="getTags()">

        <table id="product">

        </table>  
        <div>
            <!--            Fetch   <select id="stateId" name="" style="width:150;" onchange="getSelectedValue();">
                            <option value="NONE" title=" ">NONE</option>
                            <option value="CRAWLED" title=" ">CRAWLED</option>
                            <option value="CURATED" title=" ">CURATED</option>
                            <option value="CURATED_AND_VERIFIED" title=" ">CURATED_AND_VERIFIED</option>
                            <option value="NEEDS_RECURATION" title=" ">NEEDS_RECURATION</option>
                            <option value="ARCHIVED" title=" ">ARCHIVED</option>
            
                        </select> Products with keyword  <select id="select_tag" onchange="tagSelectionVal()" name="selection" multiple="multiple"   style="width: 200px" >
                        </select>   -->
            <!--            <input type='button' id="fetch_button_id" value='Fetch ' style="margin-left: 25px;"   onClick="getProducts()"/> -->
            <!--            <hr>-->
            <div> <H2 align="center" id="create_aisle_heading">Create Aisle</H2></div>



            <select id="LookingFor_tag" onchange="lookingForSelectionVal()" name="selection" multiple="multiple" style="width:150;"   >
            </select> &nbsp &nbsp &nbsp For &nbsp &nbsp &nbsp <select id="Occassion_tag" onchange="occasionSelectionVal()" name="selection" multiple="multiple"   style="width: 200px" >
            </select> 
              <input type='button' id="fetch_button_id_occasion" value='Fetch ' style="margin-left: 50px;"   onClick="getProductWithOccasion()"/> 
            <p>OR</p>     <select id="titleID"   onchange="onTitleSelectionChange()" name="selection"    multiple="multiple" style="width: 200px"  >
            </select>&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  &nbsp &nbsp  &nbsp &nbsp
            <select id="productType_tag" onchange="productTypeTag()" name="selection" multiple="multiple" style="width:150;"   ></select>
            <input type='button' id="fetch_button_id" value='Fetch ' style="margin-left: 5px;"   onClick="getProducts()"/> 
            <button class="link" id="btTagOne" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagTwo" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagThree" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagFour" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagFive" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagSix" onclick="titleTag(this)"> </button>
            <button class="link" id="btTagSeven" onclick="titleTag(this)"> </button>
            
            <hr>

        </div><br><br>
        <div class="outside">

            <p id='btnPrevious' style="margin-left:30em;"><span id="slider-prev"></span> | <span id="slider-next"></span></p>



            <p id='btnNext'  style="margin-right:30em;"><span id="slider-prev2"></span> | <span id="slider-next2"></span></p>
        </div>


        <table align="center"  style="border-spacing: 20px;"><tr>
                <td  > <p id='products_text_id'> Select products from here</p>  

                    <div  id = 'products_holder_id' class="slider6">
                        <div> <img src ='images/aisle_bagroundvue.png' /></div>

                    </div>  

                </td> 

                <td  >
                    <div>
                        <div class="outside"><p id='products_id'> Selected Products:</p> 

                            <input type='button' id='submit_button' value='Submit Aisle' onClick="onSubmitAisleButtonClick()"/> 
                        </div> 


                        <div id='aisle_holder_id' class="slider8">
                            <div> <img src ='images/aislebg.jpg'  /></div>
                        </div>

                    </div>

                </td>
                <!--<td width = 600 id='product_info_id'>
                
                
                                </td> -->

            </tr>
        </table>
        <script>


            $(document).ready(function() {
                document.getElementById("titleID").style.marginLeft = "50px";
                document.getElementById("fetch_button_id").style.marginLeft = "50px";
                document.getElementById("fetch_button_id").style.marginRight = "50px";
                // ajaxcallToPType('OccasionsCuration.csv', titleTags);


            });
            var aisleSlider;
            $(document).ready(function() {

                aisleSlider = $('.slider8').bxSlider({
                    nextSelector: '#slider-next2',
                    prevSelector: '#slider-prev2',
                    slideWidth: 400,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            });
            var slider;

            $(document).ready(function() {
                slider = $('.slider6').bxSlider({
                    nextSelector: '#slider-next',
                    prevSelector: '#slider-prev',
                    slideWidth: 400,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            });

            function aisleSldierReload() {
                aisleSlider.reloadSlider({
                    nextSelector: '#slider-next2',
                    prevSelector: '#slider-prev2',
                    slideWidth: 400,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            }

            function sliderReload() {
                //e.preventDefault();
                slider.reloadSlider({
                    nextSelector: '#slider-next',
                    prevSelector: '#slider-prev',
                    nextText: 'Next →',
                    slideWidth: 400,
                    adaptiveHeight: true,
                    prevText: '← Back'
                });
            }
            function movePorductsSlider(postion) {
                slider.goToSlide(postion);
            }
            function moveAisleSlider(postion) {
                aisleSlider.goToSlide(postion);
            }
            function changeButton(isAisleReadyToUpload, count) {
                if (isAisleReadyToUpload) {
                    window.top.postMessage('aislePost#Ready#' + count, '*');
                } else {
                    window.top.postMessage('aislePost#NotReady#' + count, '*');
                }
            }
            function onSubmitAisleButtonClick() {
                if (occasion === undefined || occasion.length < 1) {
                    alert("Please select occasion");
                    retrun;
                }
                if (lookingFor === undefined || lookingFor.length < 1) {
                    alert("Please select lookingFor");
                    retrun;
                }
                aisleCount = aisleCount + 1;
                ga('send', 'event', 'button', 'click', 'Submit Aisle', aisleCount);
                uploadProductCount = 0;
                getSelectedProducts();
                createAisleRequest();

            }

        </script>
    </body>


</html>

<style>
    #or_id {


        margin-right: 20px;
        margin-left: 20px;
    }
    button.link { background:none;border:none; }
    .outside{
        text-align:center;
    }

    #btnPrevious
    {
        float:left;
    }
    #btnNext
    {
        float:right;
    }
    #products_id
    {
        float:left;
    }

    .test{
        display:inline-block;
    }


    .center {
        margin: auto;

    }
    .container{
        width:500px;
        height:550px;
        padding:20px;
        border:1px solid gray;
        -webkit-box-sizing:border-box;
        -moz-box-sizing:border-box;
        box-sizing:border-box;
        background: white;	
    }
    .slider_wrapper{
        overflow: hidden;
        position:relative;
        height:500px;
        top:auto;
    }

    .nvgt{
        position:absolute;
        top: 120px;
        height: 50px;
        width: 30px;
        opacity: 0.6;
    }
    .nvgt:hover{
        opacity: 0.9;
    }
    input.largerCheckbox
    {
        width: 30px;
        height: 30px;
    }
    label{width:150px; display:inline-block}
    input[type="checkbox"]:checked+label{background:green; color:white}​

    .myButtonRED {
        -moz-box-shadow: inset 0px 39px 0px -24px #e67a73;
        -webkit-box-shadow: inset 0px 39px 0px -24px #e67a73;
        box-shadow: inset 0px 39px 0px -24px #e67a73;
        background-color: #e4685d;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid #ffffff;
        display: inline-block;
        cursor: pointer;
        color: #ffffff;
        font-family: arial;
        font-size: 15px;
        padding: 6px 15px;
        text-decoration: none;
        text-shadow: 0px 1px 0px #b23e35;
    }
    .pos_fixed {
        position: fixed;
        top: 30px;
        right: 150px;

    }

    hr {
        display: block;
        height: 1px;
        border: 0;
        border-top: 1px solid #ccc;
        margin: 1em 0;
        padding: 0;
    }
    .multiselect {
        width:20em;
        height:15em;
        border:solid 1px #c0c0c0;
        overflow:auto;
    }

    .multiselect label {
        display:block;
    }

    .multiselect-on {
        color:#ffffff;
        background-color:#000099;
    }

</style>

