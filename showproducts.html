<html>
    <head>
    <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-55582645-2', 'auto');
            ga('send', 'pageview');

        </script>
        <meta charset="utf-8">

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
        <script src="jquery.bxslider.js"></script>
        <link href="jquery.bxslider.css" rel="stylesheet" /> 

        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.css" />
        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.filter.css" />
        <link rel="stylesheet" type="text/css" href="assets/style.css" />
        <link rel="stylesheet" type="text/css" href="assets/prettify.css" />
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/ui-lightness/jquery-ui.css" />
        <!--        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>-->
        <script type="text/javascript" src="src/jquery.multiselect.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.filter.js"></script>
        <script type="text/javascript" src="assets/prettify.js"></script> 



        <script src="uploadTask.js" type="text/javascript"></script>
        <script>
            var tagsrequest;
            var stateValue = 'CURATED';
            var offset = 0;
            var limit = 20;
            var aisleOwnerName = "Anonymous";
            var request;
            var newheight;

            var userId;
            var category;
            var occasion;
            var lookingFor;
            var aisleOwnerName;
            var uploadProductCount = 0;
            var aisleCount = 0;
            window.onmessage = function(e) {
                var data = e.data.split("#");
                if (data[0] === 'getSelectedProducts') {
                    getSelectedProducts();

                    if (selectedProducts.length > 0) {
                        for (var i = 0; i < selectedProducts.length; i++) {
                            var productString = JSON.stringify(selectedProducts[i]);
                            window.top.postMessage(productString, '*');
                        }
                        window.top.postMessage('done', '*');
                    }
                }
                if (data[0] === 'getproducts') {

                    getCrawledProducts(data[1], data[2], data[3], data[4]);
                }
                if (data[0] === 'getAllAisles') {
                    getAllAislesByUser(data[1]);
                }
                if (data[0] == 'clearProducsts') {
                    crearPorducts();
                }
                if (data[0] === 'User') {

                    if (data[1] !== '0') {
                        getUser(data[1]);
                        // getUser("6419807607980032");
                    }

                }
            };
        </script>
    

        <script>

            function getTags() {
                document.getElementById('products_holder_id').setAttribute("style","width:800px");
                 document.getElementById('aisle_holder_id').setAttribute("style","width:800px");
                newheight = screen.height - 120;
                getMe();
                var fetchButton = document.getElementById("fetch_button_id");
                fetchButton.style.backgroundColor = "white";
                fetchButton.style.color = "green";
                fetchButton.style.outline = "solid orange";
                var url = "https://vue-server-dev.appspot.com/api/producttags/all";
                if (XMLHttpRequest)
                {
                    tagsrequest = new XMLHttpRequest();
                    if ("withCredentials" in tagsrequest)
                    {
                        // Firefox 3.5 and Safari 4
                        tagsrequest.open('GET', url, true);
                        tagsrequest.onreadystatechange = tagRespnseHandler;
                        tagsrequest.send();
                    }
                }
            }
            function tagRespnseHandler() {
                if (tagsrequest.readyState !== 4)
                    return;
                if (tagsrequest.status === 200)
                {

                    var tagString = tagsrequest.responseText;
                    var jsonResponse = JSON.parse(tagString);
                    var blocked = [];
                    console.log("tags are downloaded " + jsonResponse.length);
                    for (var k = 0; k < jsonResponse.length; k++) {
                        var tagObject = jsonResponse[k];
                        if (tagObject.tagString.charAt(0) === tagObject.tagString.charAt(0).toLowerCase()) {
                            console.log(tagObject.tagString + " length : " + tagObject.tagString.length);
                            blocked.push(tagObject);
                        }
                    }
                    for (var i = 0; i < blocked.length; i++) {

                        var t = jsonResponse.indexOf(blocked[i]);
                        if (t !== -1) {
                            jsonResponse.splice(t, 1);
                        }
                    }
                    var tagSubCatelement = document.getElementById('select_tag');
                    var occasionSubCatelement = document.getElementById('Occassion_tag');
                    var lookingForSubCatelement = document.getElementById('LookingFor_tag');
                    document.getElementById("stateId").value = stateValue;
                    //var temp2 = tag_string_array[static_categoryNames[k]];
                    //  tagSubCatelement.options[tagSubCatelement.options.length] = new Option('', '', false, false);
                    for (var i = 0; i < jsonResponse.length; i++) {
                        console.log("Blocked list " + jsonResponse[i].tagString);
                        tagSubCatelement.options[tagSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        if (jsonResponse[i].tagCategory === "Occasion") {
                            occasionSubCatelement.options[occasionSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }
                        if (jsonResponse[i].tagCategory === "Product Type") {
                            lookingForSubCatelement.options[lookingForSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }
                    }
                    $("select").multiselect({
                        multiple: false,
                        header: "Select an option",
                        noneSelectedText: "Select an Option",
                        selectedList: 1
                    }).multiselectfilter();

                    $(function() {
                        var warning = $(".message");

                        $("select").multiselect({
                            header: "Choose only TWO items!",
                            click: function(e) {

                                if ($(this).multiselect("widget").find("input:checked").length > 1) {
                                    warning.addClass("error").removeClass("success").html("You can only check one checkboxe!");
                                    alert("cant select more than one value");
                                    return false;
                                } else {
                                    warning.addClass("success").removeClass("error").html("Check a few boxes.");
                                }

                            }
                        });
                    });

                }
                if (tagsrequest.status !== 200 && tagsrequest.status !== 304) {
                    alert('HTTP GET error ' + tagsrequest.status);
                    return;
                }
            }
            function occasionSelectionVal() {
                var selectedValue = $("#Occassion_tag").val();
                ga('send', 'event', 'option', 'select', selectedValue);
                occasion = selectedValue;
                document.getElementById("Occassion_tag").value = selectedValue;
            }
            function lookingForSelectionVal() {
                var selectedValue = $("#LookingFor_tag").val();
                lookingFor = selectedValue;
                ga('send', 'event', 'option', 'select', selectedValue);
                document.getElementById("LookingFor_tag").value = selectedValue;
            }
            function tagSelectionVal() {
                var selectedValue = $("#select_tag").val();
                offset = 0;
                 ga('send', 'event', 'option', 'select', selectedValue);
                category = selectedValue;
                document.getElementById('fetch_button_id').value = "Fetch";
                document.getElementById("select_tag").value = selectedValue;
            }
            function getSelectedValue() {
                stateValue = $("#stateId").val();
                 ga('send', 'event', 'option', 'select', stateValue);
                document.getElementById('fetch_button_id').value = "Fetch";
                offset = 0;
                document.getElementById("stateId").value = stateValue;
            }

            function getProducts() {
                document.getElementById('create_aisle_heading').scrollIntoView();
                var buttonValue = document.getElementById('fetch_button_id').value;
                if (buttonValue === "Fetch More") {
                     ga('send', 'event', 'button', 'click', 'Fetch More');
                    offset = offset + limit;
                    document.getElementById('fetch_button_id').value = "Fetch More";
                } else {
                    offset = 0;
                     ga('send', 'event', 'button', 'click', 'Fetch');
                    document.getElementById('fetch_button_id').value = "Fetch More";
                }
                var tagKey = document.getElementById("select_tag").value;



                if (tagKey === undefined || tagKey.length === 0) {
                    alert("Please Select Tag");
                    return;
                }
                getCrawledProducts(tagKey, offset, limit, stateValue);

                //window.top.postMessage('getproducts#' + tagKey + "#" + offset + "#" + limit + "#" + stateValue, '*');


            }
            function getUser(id) {
                var url = "https://vue-server-dev.appspot.com/api/user/" + id;
                console.log("user url" + url);
                if (XMLHttpRequest)
                {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request)
                    {
                        // Firefox 3.5 and Safari 4
                        request.open('GET', url, true);
                        request.onreadystatechange = get_handler_aisle;
                        request.send();
                    }
                }
            }
            function get_handler_aisle() {
                if (request.readyState != 4)
                    return;
                if (request.status != 200 && request.status != 304) {
                    alert('User reqeust Error ' + request.status);
                    return;
                }
                if (request.status == 200)
                {

                    var user = JSON.parse(request.responseText);
                    aisleOwnerName = user.firstName + " " + user.lastName;

                    userId = user.id;
                    
                    
                   ga('create', 'UA-55582645-2', { 'userId': userId });
                     ga('send', 'pageview');
                    // alert('HTTP GET success: ' + urlUserID);

                }

            }

            function getMe() {

                window.top.postMessage('getUser', '*');
            }

            function createAisleRequest() {   
                if (occasion.length < 1)
                {
                    showAlert("Please Select Occassion");
                    document.getElementById('Occassion_tag').scrollIntoView();
                    return false;
                }
                
                if (lookingFor.length < 1)
                {
                    showAlert("Please Select LookingFor");
                    document.getElementById('LookingFor_tag').scrollIntoView();
                    return false;
                }
              alert("checking success");
             
                var url = "https://vue-server-dev.appspot.com/api/aisle";
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('POST', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = aisle_post_handler;
                        //aisle creation request.
                       request.send(JSON.stringify({id: null, ownerUserId: userId, category: category, description: description, lookingFor: lookingFor, name: aisleOwnerName, occassion: occasion, currentAisleState: "CURATED", bookmarkCount: 0}));
                    }
                }
            }
            function aisle_post_handler() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status === 200)
                {
                    //get the aisle id and start updating products from here.
                    alert("Curated Successfully " + request.responseText);
                    var jsonObject = JSON.parse(request.responseText);
                    aisleId = jsonObject.id;
                    console.log("aisle Id: " + aisleId);
                    //uploadin aisle products

                    uploadAisleProduct(selectedProducts[uploadProductCount]);

                }

            }
            function uploadAisleProduct(product) {
                var url = "https://vue-server-dev.appspot.com/api/product/" + product.id;
                console.log("url: " + url);
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('PUT', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = update_handler;
                        //product update request:

                        request.send(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                        console.log(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                    }
                }
            }
            function update_handler() {
                if (request.readyState != 4)
                    return;
                if (request.status != 200 && request.status != 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status == 200)
                {
                    //alert("Curated Successfully " + request.responseText);
                    uploadProductCount = uploadProductCount + 1;
                    if (uploadProductCount < selectedProducts.length) {
                        uploadAisleProduct(selectedProducts[uploadProductCount]);
                    } else {
                        alert("Aisle created successfully with  " + uploadProductCount + " products");
                    }
                }

            }

        </script>






    </head>

    <body onLoad="getTags()">

        <table id="product">

        </table>  
        <div>
            Fetch   <select id="stateId" name="" style="width:150;" onchange="getSelectedValue();">
                <option value="NONE" title=" ">NONE</option>
                <option value="CRAWLED" title=" ">CRAWLED</option>
                <option value="CURATED" title=" ">CURATED</option>
                <option value="CURATED_AND_VERIFIED" title=" ">CURATED_AND_VERIFIED</option>
                <option value="NEEDS_RECURATION" title=" ">NEEDS_RECURATION</option>
                <option value="ARCHIVED" title=" ">ARCHIVED</option>

            </select> Products with keyword  <select id="select_tag" onchange="tagSelectionVal()" name="selection" multiple="multiple"   style="width: 200px" >
            </select>   
            <input type='button' id="fetch_button_id" value='Fetch ' style="margin-left: 25px;"   onClick="getProducts()"/> 
            <hr>
            <div> <H2 align="center" id="create_aisle_heading">Create Aisle</H2></div>


            <img src=" " alt="Smiley face" width="42" height="42" style="margin-right:35px;">
            LookingFor   <select id="LookingFor_tag" onchange="lookingForSelectionVal()" name="" style="width:150;" onchange="getSelectedValue();" >
            </select> Occasion  <select id="Occassion_tag" onchange="occasionSelectionVal()" name="selection" multiple="multiple"   style="width: 200px" >
            </select>   
            <hr>
            <script type="text/javascript">
                $("select").multiselect({
                    multiple: false,
                    header: "Select an option",
                    noneSelectedText: "Select an Option",
                    selectedList: 1
                });
            </script>
        </div><br><br>
        <div class="outside">

            <p id='btnPrevious' style="margin-left:30em;"><span id="slider-prev"></span> | <span id="slider-next"></span></p>



            <p id='btnNext'  style="margin-right:30em;"><span id="slider-prev2"></span> | <span id="slider-next2"></span></p>
        </div>

        <table align="center"  style="border-spacing: 20px;"><tr>
                <td  ><p id='products_text_id'> Select products from here</p> 
                    <div  id = 'products_holder_id' class="slider6">
                        <div> <img src ='images/aisle_baground.png' width="600" height="600"/></div>

                    </div>  

                </td> 

                <td  >
                    <div class="outside"><p id='products_id'> Selected Products:</p> 

                        <input type='button' id='submit_button' value='Submit Aisle' onClick="onSubmitAisleButtonClick()"/> 
                    </div>
                    <div id='aisle_holder_id' class="slider8">
                        <div> <img src ='images/aisle_baground.png' width="600" height="600"/></div>
                    </div>



                </td>
                <!--<td width = 600 id='product_info_id'>
                
                
                                </td> -->

            </tr>
        </table>
        <script>
            var aisleSlider;
            $(document).ready(function() {

                aisleSlider = $('.slider8').bxSlider({
                    nextSelector: '#slider-next2',
                    prevSelector: '#slider-prev2',
                    slideWidth: 600,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            });
            var slider;

            $(document).ready(function() {
                slider = $('.slider6').bxSlider({
                    nextSelector: '#slider-next',
                    prevSelector: '#slider-prev',
                    slideWidth: 600,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            });

            function aisleSldierReload() {
                aisleSlider.reloadSlider({
                    nextSelector: '#slider-next2',
                    prevSelector: '#slider-prev2',
                    slideWidth:600,
                    adaptiveHeight: true,
                    nextText: 'Next →',
                    prevText: '← Back'
                });
            }

            function sliderReload() {
                //e.preventDefault();
                slider.reloadSlider({
                    nextSelector: '#slider-next',
                    prevSelector: '#slider-prev',
                    nextText: 'Next →',
                    slideWidth: 600,
                    adaptiveHeight: true,
                    prevText: '← Back'
                });
            }
            function movePorductsSlider(postion){
                slider.goToSlide(postion);
            }
            function moveAisleSlider(postion){
                aisleSlider.goToSlide(postion);
            }
            function changeButton(isAisleReadyToUpload, count) {
                if (isAisleReadyToUpload) {
                    window.top.postMessage('aislePost#Ready#' + count, '*');
                } else {
                    window.top.postMessage('aislePost#NotReady#' + count, '*');
                }
            }
            function onSubmitAisleButtonClick() {
                if(occasion === undefined || occasion.length < 1){
                    alert("Please select occasion");
                    retrun;
                }
                  if(lookingFor === undefined || lookingFor.length < 1){
                    alert("Please select lookingFor");
                    retrun;
                }
                aisleCount = aisleCount +1;              
                ga('send', 'event', 'button', 'click', 'Submit Aisle', aisleCount);
                uploadProductCount = 0;
                getSelectedProducts();              
                createAisleRequest();

            }
        </script>
    </body>


</html>

<style>
    .outside{
        text-align:center;
    }

    #btnPrevious
    {
        float:left;
    }
    #btnNext
    {
        float:right;
    }
    #products_id
    {
        float:left;
    }

    .test{
        display:inline-block;
    }


    .center {
        margin: auto;

    }
    .container{
        width:500px;
        height:550px;
        padding:20px;
        border:1px solid gray;
        -webkit-box-sizing:border-box;
        -moz-box-sizing:border-box;
        box-sizing:border-box;
        background: white;	
    }
    .slider_wrapper{
        overflow: hidden;
        position:relative;
        height:500px;
        top:auto;
    }

    .nvgt{
        position:absolute;
        top: 120px;
        height: 50px;
        width: 30px;
        opacity: 0.6;
    }
    .nvgt:hover{
        opacity: 0.9;
    }
    input.largerCheckbox
    {
        width: 30px;
        height: 30px;
    }
    label{width:150px; display:inline-block}
    input[type="checkbox"]:checked+label{background:green; color:white}​

    .myButtonRED {
        -moz-box-shadow: inset 0px 39px 0px -24px #e67a73;
        -webkit-box-shadow: inset 0px 39px 0px -24px #e67a73;
        box-shadow: inset 0px 39px 0px -24px #e67a73;
        background-color: #e4685d;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid #ffffff;
        display: inline-block;
        cursor: pointer;
        color: #ffffff;
        font-family: arial;
        font-size: 15px;
        padding: 6px 15px;
        text-decoration: none;
        text-shadow: 0px 1px 0px #b23e35;
    }
    .pos_fixed {
        position: fixed;
        top: 30px;
        right: 150px;

    }

    hr {
        display: block;
        height: 1px;
        border: 0;
        border-top: 1px solid #ccc;
        margin: 1em 0;
        padding: 0;
    }
    .multiselect {
        width:20em;
        height:15em;
        border:solid 1px #c0c0c0;
        overflow:auto;
    }

    .multiselect label {
        display:block;
    }

    .multiselect-on {
        color:#ffffff;
        background-color:#000099;
    }

</style>

