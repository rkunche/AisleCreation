<html>
    <head>
        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
             //production tracker id
            ga('create', 'UA-55582645-1', 'auto');
            //dev tracker id
        //ga('create', 'UA-55582645-2', 'auto');
            ga('send', 'pageview');
 
         </script>
        <meta charset="utf-8">
        <script language="javascript" type="text/javascript" src="autocomplete.js"></script>
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>

        <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
        <script src="jquery.bxslider.js"></script>
        <link href="jquery.bxslider.css" rel="stylesheet" /> 

        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.css" />
        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.filter.css" />
        <link rel="stylesheet" type="text/css" href="assets/style.css" />
        <link rel="stylesheet" type="text/css" href="assets/prettify.css" />
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/ui-lightness/jquery-ui.css" />
        <!--        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>-->
        <script type="text/javascript" src="jquery.csv-0.71.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.filter.js"></script>
        <script type="text/javascript" src="assets/prettify.js"></script> 



        <script src="uploadTask.js" type="text/javascript"></script>
        <script>
            var tagsrequest;

            var offset = 0;
            var limit = 8;
            var aisleOwnerName = "Anonymous";
            var request;
            var newheight;

            var userId;
            var category;
            var occasion;
            var lookingFor;
            var productType;
            var aisleOwnerName;
            var uploadProductCount = 0;
            var aisleCount = 0;
            var lookingForTag;
            var titleTags = [];
            var selectedWord;
            var itemArray = [];
            var subItem = [];
            var aisleTitle;
            var titleWord;
            var primaryTag;
            var primaryValue;
            var secodryValue;
            var number_aisle_added;
            var allTags = [];
            //prototype for clear the array values.
            Array.prototype.clear = function() {
                this.length = 0;
            };
            window.onmessage = function(e) {
                var data = e.data.split("#");
                if (data[0] === 'getSelectedProducts') {
                    getSelectedProducts();

                    if (selectedProducts.length > 0) {
                        for (var i = 0; i < selectedProducts.length; i++) {
                            var productString = JSON.stringify(selectedProducts[i]);
                            window.top.postMessage(productString, '*');
                        }
                        window.top.postMessage('done', '*');
                    }
                }
                if (data[0] === 'getproducts') {

                }
                if (data[0] === 'getAllAisles') {
                    getAllAislesByUser(data[1]);
                }
                if (data[0] === 'clearProducsts') {
                    crearPorducts();
                }
                if (data[0] === 'User') {

                    if (data[1] !== '0') {
 
console.log("USER ID: "+data[1]);
ga('set', '&uid', data[1]);
 ga('send', 'pageview');
                        getUser(data[1]);
                        // getUser("6419807607980032");
                    }

                }
            };
        </script>


        <script>

            function getTags() {
                 hideGif();
                document.getElementById('products_holder_id').setAttribute("style", "width:800px");
                document.getElementById('aisle_holder_id').setAttribute("style", "width:800px");
                newheight = screen.height - 120;
                getMe();
                enableButton(4);
                var button_fetchMore = document.getElementById('fetch_more_button_id');
                setStyleToButton(button_fetchMore, true);
                var url = "https://vue-server-dev.appspot.com/api/producttags/all";
                if (XMLHttpRequest)
                {
                    tagsrequest = new XMLHttpRequest();
                    if ("withCredentials" in tagsrequest)
                    {
                        // Firefox 3.5 and Safari 4
                        tagsrequest.open('GET', url, true);
                        tagsrequest.onreadystatechange = tagRespnseHandler;
                        tagsrequest.send();
                    }
                }
                //sets the text mouse events for the title words.
                var buttonOne = document.getElementById("btTagOne");
                var buttonTwo = document.getElementById("btTagTwo");
                var buttonThree = document.getElementById("btTagThree");
                var buttonFour = document.getElementById("btTagFour");
                var buttonFive = document.getElementById("btTagFive");
                var buttonSix = document.getElementById("btTagSix");


                textMouseEvents(buttonOne);
                textMouseEvents(buttonTwo);
                textMouseEvents(buttonThree);
                textMouseEvents(buttonFour);
                textMouseEvents(buttonFive);
                textMouseEvents(buttonSix);
            }
            function textMouseEvents(button_var) {
                button_var.style.color = "black";
                button_var.onmouseover = function()
                {
                    this.style.color = "green";
                }

                button_var.onmouseout = function()
                {
                    this.style.color = "black";
                }
            }
            function tagRespnseHandler() {
                if (tagsrequest.readyState !== 4)
                    return;
                if (tagsrequest.status === 200)
                {
                    var tagString = tagsrequest.responseText;
                    var jsonResponse = JSON.parse(tagString);
                    var blocked = [];

                    for (var k = 0; k < jsonResponse.length; k++) {
                        var tagObject = jsonResponse[k];
                        if (tagObject.tagString.charAt(0) === tagObject.tagString.charAt(0).toLowerCase()) {
                           // console.log(tagObject.tagString + " length : " + tagObject.tagString.length);
                            blocked.push(tagObject);
                        }
                    }
                    for (var i = 0; i < blocked.length; i++) {

                        var t = jsonResponse.indexOf(blocked[i]);
                        if (t !== -1) {
                            jsonResponse.splice(t, 1);
                        }
                    }
                    var productType = document.getElementById('productType_tag');
                    var occasionSubCatelement = document.getElementById('Occassion_tag');
                    var lookingForSubCatelement = document.getElementById('occasionProductType');
                    var titleProductType = document.getElementById('title_ProductType');
                    allTags.clear();
                    for (var i = 0; i < jsonResponse.length; i++) {
                        allTags.push(jsonResponse[i].tagString);
                        // tagSubCatelement.options[tagSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        if (jsonResponse[i].tagCategory === "Occasion") {
                            occasionSubCatelement.options[occasionSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }

                        if (jsonResponse[i].tagCategory === "Product Type") {
                            lookingForSubCatelement.options[lookingForSubCatelement.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                            productType.options[productType.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                            titleProductType.options[titleProductType.options.length] = new Option(jsonResponse[i].tagString, jsonResponse[i].tagString, false, false);
                        }
                        if (jsonResponse[i].tagCategory === "Product description") {
                           // console.log(jsonResponse[i].tagString);
                        }
                    }
                    ajaxcallToPType('OccasionsCuration.csv', titleTags);
                    ajaxcallToReadWordsList('wordslist.csv', allTags);
                    $("#Occassion_tag").multiselect({
                        multiple: false,
                        header: "Occasion",
                        noneSelectedText: "Occasion",
                        selectedList: 1
                    }).multiselectfilter();
                    $("#occasionProductType").multiselect({
                        multiple: false,
                        header: "Product Type",
                        noneSelectedText: "Product Type (optional)",
                        selectedList: 1
                    }).multiselectfilter();
                    $("#productType_tag").multiselect({
                        multiple: false,
                        header: "Product Type",
                        noneSelectedText: "Product Type",
                        selectedList: 1
                    }).multiselectfilter();
                    $("#title_ProductType").multiselect({
                        multiple: false,
                        header: "Product Type",
                        noneSelectedText: "Product Type  (optional)",
                        selectedList: 1
                    }).multiselectfilter();

                    $(function() {
                        var warning = $(".message");

                        $("select").multiselect({
                            header: "Aisle Title",
                            click: function(e) {

                                if ($(this).multiselect("widget").find("input:checked").length > 1) {
                                    warning.addClass("error").removeClass("success").html("You can only check one checkboxe!");
                                    alert("cant select more than one value");
                                    return false;
                                } else {
                                    warning.addClass("success").removeClass("error").html("Check a few boxes.");
                                }

                            }
                        });
                    });

                }
                if (tagsrequest.status !== 200 && tagsrequest.status !== 304) {
                    alert('HTTP GET error ' + tagsrequest.status);
                    return;
                }
            }
            //toggling button colors when primary type selection.
            function enableButton(option) {
                var buttonVar1 = document.getElementById('fetch_button_id_opt1');
                var buttonVar2 = document.getElementById('fetch_button_op2');
                var buttonVar3 = document.getElementById('fetch_button_id');
                if (option === 1) {
                    setStyleToButton(buttonVar1, true);
                    setStyleToButton(buttonVar2, false);
                    setStyleToButton(buttonVar3, false);
                }
                if (option === 2) {
                    setStyleToButton(buttonVar1, false);
                    setStyleToButton(buttonVar2, true);
                    setStyleToButton(buttonVar3, false);
                }
                if (option === 3) {
                    setStyleToButton(buttonVar1, false);
                    setStyleToButton(buttonVar2, false);
                    setStyleToButton(buttonVar3, true);
                }

                if (option === 4) {
                    setStyleToButton(buttonVar1, false);
                    setStyleToButton(buttonVar2, false);
                    setStyleToButton(buttonVar3, false);
                }



            }
            function setStyleToButton(btn, flag) {
                if (flag) {
                    btn.style.backgroundColor = "white";
                    btn.style.color = "green";
                    btn.style.outline = "solid orange";
                } else {
                    btn.style.backgroundColor = "white";
                    btn.style.color = "black";
                    btn.style.outline = "gray";
                }
            }
            function checkAisleAddedInfo() {
                var submitFlag = false;
                aisleProductsCount();
                if (number_aisle_added >= 3) {
                    var r2 = confirm("Aisle has " + number_aisle_added + " products, from " + primaryTag + " Do you want to submit?");
                    if (r2 === true) {
                        submitFlag = true;
                    } else {
                        submitFlag = false;
                    }
                }
                if (submitFlag === true) {
                    aisleCount = aisleCount + 1;
                    ga('send', 'event', 'button', 'click', 'Submit Aisle', aisleCount);
                    uploadProductCount = 0;
                    getSelectedProducts();
                    createAisleRequest();
                }
                clearProducts();
            }
            function occasionSelectionVal() {
                secodryValue = null;
                checkAisleAddedInfo();               
                   document.getElementById("occasionProductType").value = "selectedValue";
                    $('#occasionProductType').multiselect('refresh');
                var selectedValue = $("#Occassion_tag").val();
                offset = 0;
                primaryTag = "OCCASION";
                resetOptionOne();
                resetOptionThree();
                document.getElementById('tag_id').innerHTML = "Creating an aisle for Occasion: '" + selectedValue + "'";
                document.getElementById('titleID').value = "Fetch with Title";
                document.getElementById('fetch_button_id_opt1').value = "Fetch with ProductType";
                document.getElementById('fetch_button_op2').value = "Fetch with Occasion";
                occasion = selectedValue[0];
                primaryValue = selectedValue;
                ga('send', 'event', 'option', 'select',"OPTION_TWO::"+ selectedValue);
                enableButton(2);


            }
            function occasionProduct_Type() {
                if (occasion === null || occasion === undefined) {
                    document.getElementById("occasionProductType").value = "selectedValue";
                    $('#occasionProductType').multiselect('refresh');
                    alert("Please select occasion first");
                    return;
                }
                var selectedValue = $("#occasionProductType").val();
                secodryValue = selectedValue[0];
                document.getElementById('tag_id').innerHTML = "Creating an aisle for Occasion:: '" + occasion + "'" + " With Product: '" + secodryValue + "'";
                offset = 0;
            }
            function titleProduct_Type() {
                if (aisleTitle === null || aisleTitle === undefined) {
                    document.getElementById("title_ProductType").value = "selectedValue";
                    $('#title_ProductType').multiselect('refresh');
                    alert("Please select title first");
                    return;
                }
                var selectedValue = $("#title_ProductType").val();
                secodryValue = selectedValue[0];
                ga('send', 'event', 'option', 'select', secodryValue);
                // document.getElementById('tag_id').innerHTML = "Creating an aisle :: '" + aisleTitle + "'" + "With Product: '" + secodryValue + "'"; 
            }

            function productTypeTag() {
                secodryValue = null;
                var selectedValue = $("#productType_tag").val();
                checkAisleAddedInfo();

                offset = 0;
                primaryTag = "PRODUCT_TYPE";

                productType = selectedValue[0];
                primaryValue = selectedValue[0];
                document.getElementById('tag_id').innerHTML = "Creating an aisle with Product Type: '" + selectedValue + "'";
                document.getElementById('titleID').value = "Fetch with Title";
                document.getElementById('fetch_button_id_opt1').value = "Fetch with ProductType";
                document.getElementById('fetch_button_op2').value = "Fetch with Occasion";
                resetOptionTwo();
                resetOptionThree();
                enableButton(1);
                ga('send', 'event', 'option', 'select', "OPTION_ONE:: "+selectedValue[0]);

            }
            function onTitleSelectionChange() {
                secodryValue = null;
                var position;
                  document.getElementById("title_ProductType").value = "selectedValue";
                    $('#title_ProductType').multiselect('refresh');
                var selectedValue = $("#titleID").val();  
                 ga('send', 'event', 'option', 'select', "OPTION_THREE:: "+selectedValue);
                checkAisleAddedInfo();
                offset = 0;
                primaryTag = "TITLE";
                resetOptionOne();
                resetOptionTwo();

                document.getElementById('tag_id').innerHTML = "Creating an aisle title: '" + selectedValue + "'";
                document.getElementById('titleID').value = "Fetch with Title";
                document.getElementById('fetch_button_id_opt1').value = "Fetch with ProductType";
                document.getElementById('fetch_button_op2').value = "Fetch with Occasion";
                aisleTitle = selectedValue;
                primaryValue = selectedValue;

                for (var i = 0; i < itemArray.length; i++) {
                    if (itemArray[i].title.split(":")[1].localeCompare(selectedValue) === 0) {
                        position = i;
                        break;
                    }
                }

                var tagsArray = [];
                if (position !== undefined) {
                    var titleObject = itemArray[position];
                    if (titleObject !== undefined) {
                        var tags;
                        tags = titleObject.Tags.split(":")[1];
                        tagsArray = tags.split(";");
                    }
                }
                if (tagsArray.length >= 1) {

                    document.getElementById("productType_tag").style.visibility = "hidden";
                }
                if (tagsArray[0] !== undefined) {
                    document.getElementById('btTagOne').innerHTML = tagsArray[0];
                }
                if (tagsArray[1] !== undefined) {
                    document.getElementById('btTagTwo').innerHTML = tagsArray[1];
                }
                if (tagsArray[2] !== undefined) {
                    document.getElementById('btTagThree').innerHTML = tagsArray[2];
                }
                if (tagsArray[3] !== undefined) {
                    document.getElementById('btTagFour').innerHTML = tagsArray[3];
                }
                if (tagsArray[4] !== undefined) {
                    document.getElementById('btTagFive').innerHTML = tagsArray[4];
                }
                if (tagsArray[5] !== undefined) {
                    document.getElementById('btTagSix').innerHTML = tagsArray[5];
                }
                enableButton(3);
            }
            //title keyword click
            var titleTag = function(param) {
                offset = 0;
                if (selectedWord === undefined) {
                    selectedWord = param.innerHTML;

                }
                var tag = param.innerHTML;
                titleWord = tag;
                // document.getElementById('fetch_button_id').value = "Fetch More";
                var filterWord = document.getElementById('filter_word_opt3').value;
                if (filterWord === '') {
                    filterWord = null;
                }
                var titleVal = aisleTitle;             
                if(filterWord !== null && filterWord !== undefined){
                     filterWord = filterWord+" "+tag;
                }else {
                      filterWord =  tag;
                }
                console.log("AISLE TITLE CASE: tag "+tag);
                 console.log("AISLE TITLE CASE: secodryValue "+secodryValue);
                  console.log("AISLE TITLE CASE: filterWord "+filterWord);
                   console.log("AISLE TITLE CASE: titleVal "+titleVal);
                getCrawledProducts(titleVal, secodryValue, filterWord, offset, limit, OPTION_THREE);
            };

            //OPTION 1 button click 
            function getProductWithProductType() {
                ga('send', 'event', 'button', 'click', 'OPTION_ONE_BUTTON');
                if (productType === null || productType === undefined || productType === '') {
                    alert("Please Select ProductType");
                    return;
                }
                offset = 0;
                var filterWord = document.getElementById('filter_word_opt1').value;
                if (filterWord === '') {
                    filterWord = null;
                }
                getCrawledProducts(productType, null, filterWord, offset, limit, OPTION_ONE);
            }

            function resetOptionOne() {
                secodryValue = null;
                document.getElementById("productType_tag").value = "selectedValue";
                $('#productType_tag').multiselect('refresh');
                document.getElementById('fetch_button_id_opt1').value = 'Fetch with ProductType';
                productType = '';
                document.getElementById('filter_word_opt1').value = "";
            }
            function resetOptionTwo() {
                secodryValue = null;
                document.getElementById("occasionProductType").value = "selectedValue";
                $('#occasionProductType').multiselect('refresh');
                document.getElementById("Occassion_tag").value = "selectedValue";
                $('#Occassion_tag').multiselect('refresh');
                document.getElementById('fetch_button_op2').value = 'Fetch with Occasion';
                occasion = '';
                lookingFor = '';
                document.getElementById('filter_word_opt2').value = "";
            }
            function resetOptionThree() {
                secodryValue = null;
                document.getElementById('fetch_button_id').value = 'Fetch with Title';
                document.getElementById('btTagOne').innerHTML = " ";

                document.getElementById('btTagTwo').innerHTML = " ";

                document.getElementById('btTagThree').innerHTML = " ";

                document.getElementById('btTagFour').innerHTML = " ";

                document.getElementById('btTagFive').innerHTML = " ";

                document.getElementById('btTagSix').innerHTML = " ";
                document.getElementById("titleID").value = "selectedValue";
                $('#titleID').multiselect('refresh');
                document.getElementById("title_ProductType").value = "selectedValue";
                $('#title_ProductType').multiselect('refresh');
                aisleTitle = null;
                lookingFor = '';
                document.getElementById('filter_word_opt3').value = "";
            }
//option 2 button click
            function fetchProductWithOccasion() {
                if (occasion === null || occasion === undefined || occasion === '') {
                    alert("Please Select Occasion");
                    return;
                }
                offset = 0;
                var filterWord = document.getElementById('filter_word_opt2').value;
                if (filterWord === '') {
                    filterWord = null;
                }
                 ga('send', 'event', 'button', 'click', 'OPTION_TWO_BUTTON');
                getCrawledProducts(occasion, secodryValue, filterWord, offset, limit, OPTION_TWO);

            }
            //option 3 button click
            function getProductsWithTitle() {
 
                var searchStringTwo;
                var tagTwo = $("#title_ProductType").val();
               
                if (aisleTitle === null || aisleTitle === undefined) {
                    alert("Please Select Title");
                    return;
                }
                if (tagTwo !== null) {
                    searchStringTwo = tagTwo[0];
                }
 
                if (searchStringTwo === undefined || searchStringTwo.length < 2) {
                    searchStringTwo = null;
                }
                offset = 0;


                var filterWord = document.getElementById('filter_word_opt3').value;
                if (filterWord === '') {
                    filterWord = null;
                }
                 ga('send', 'event', 'button', 'click', 'OPTION_THREE_BUTTON');
                getCrawledProducts(aisleTitle, searchStringTwo, filterWord, offset, limit, OPTION_THREE);
            }
            function getUser(id) {
                var url = "https://vue-server-dev.appspot.com/api/user/" + id;
                console.log("user url" + url);
                if (XMLHttpRequest)
                {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request)
                    {
                        // Firefox 3.5 and Safari 4
                        request.open('GET', url, true);
                        request.onreadystatechange = get_handler_aisle;
                        request.send();
                    }
                }
            }
            function get_handler_aisle() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('User reqeust Error ' + request.status);
                    return;
                }
                if (request.status === 200)
                {
                    var user = JSON.parse(request.responseText);
                    aisleOwnerName = user.firstName + " " + user.lastName;
                    userId = user.id;
                    // ga('create', 'UA-55582645-2', {'userId': userId});
                    //ga('send', 'pageview');
                    // alert('HTTP GET success: ' + urlUserID);

                }

            }

            function getMe() {
                window.top.postMessage('getUser', '*');
            }

            function createAisleRequest() {
                category = "Fashion & Style";

                if (lookingFor === undefined || lookingFor === '') {
                    if (productType !== undefined && productType !== '') {
                        lookingFor = productType;
                    }
                }
                if (aisleTitle === undefined || aisleTitle === '') {
                    aisleTitle = null;
                }
                if (occasion === undefined || occasion === '') {
                    occasion = null;
                }
                if (lookingFor === undefined || lookingFor === '') {
                    lookingFor = null;
                }
                if (occasion === null && lookingFor === null && aisleTitle === null) {
                    alert("Please select Occasion or Product Type");
                }
                var url = "https://vue-server-dev.appspot.com/api/aisle";

                if (occasion !== null) {

                }
                if (aisleTitle !== null) {

                }
                if (lookingFor !== null) {

                }


                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('POST', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = aisle_post_handler;
                        //aisle creation request.
                        request.send(JSON.stringify({id: null, ownerUserId: userId, category: category, description: null, lookingFor: lookingFor, name: aisleTitle, productList: null, occassion: occasion, currentAisleState: "CURATED", bookmarkCount: 0}));

                        console.log(JSON.stringify({id: null, ownerUserId: userId, category: category, description: null, lookingFor: lookingFor, name: aisleTitle, productList: null, occassion: occasion, currentAisleState: "CURATED", bookmarkCount: 0}));
                    }
                }
            }
            function aisle_post_handler() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status === 200)
                {
                    //get the aisle id and start updating products from here.
                    alert("Curated Successfully " + request.responseText);
                    var jsonObject = JSON.parse(request.responseText);
                    aisleId = jsonObject.id;
                    console.log("aisle Id: " + aisleId);
                    //uploadin aisle products

                    uploadAisleProduct(selectedProducts[uploadProductCount]);

                }

            }
            function uploadAisleProduct(product) {
                var url = "https://vue-server-dev.appspot.com/api/product/" + product.id;
                console.log("url: " + url);
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('PUT', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = update_handler;
                        //product update request:

                        request.send(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                        console.log(JSON.stringify({id: product.id, ownerAisleId: aisleId, ownerProductListId: product.ownerProductListId, creatorId: product.creatorId, curatorId: product.curatorId, title: product.title, description: product.description, currentProductState: product.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                    }
                }
            }
            function update_handler() {
                if (request.readyState !== 4)
                    return;
                if (request.status !== 200 && request.status !== 304) {
                    alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
                if (request.status === 200)
                {
                    //alert("Curated Successfully " + request.responseText);
                    uploadProductCount = uploadProductCount + 1;
                    if (uploadProductCount < selectedProducts.length) {
                        uploadAisleProduct(selectedProducts[uploadProductCount]);
                    } else {
                        clearAisleProducts();
                        alert("Aisle created successfully with  " + uploadProductCount + " products");
                    }
                }

            }
            function ajaxcallToPType(pathOfFileToReadFrom, list) {
                var datatype = '';

                var ajax = $.ajax({
                    url: pathOfFileToReadFrom,
                    async: true,
                    success: function(csvd) {
                       // console.log('ajax succes: ' + csvd);
                        datatype = $.csv2Array(csvd);
                        //console.log('ajax arry: ' + datatype);

                    },
                    dataType: "text",
                });

                ajax.complete(function(jqXHR) {
                    // console.log('ajax complete ' + datatype);
                    if (jqXHR.readyState === 4) {
                        callfunction(datatype, list);
                    }
                });
            }

            function callfunction(array, list) {

                for (var i = 0; i < array.length; i++) {
                    var tmp = array[i];
                    var line = tmp;
                    for (var j = 0; j < line.length; j++) {
                        v = line[j];
                        v = $.trim(v);
                        if (v !== '' && v.length > 0) {

                            list.push(v);
                        }
                    }
                }



                var titleOBject = {title: "", Tags: ""};
                var tempArray = [];
                var filterArray = [];
                for (var j = 0; j < list.length; j++) {
                    var item = list[j];
                    if (item.length > 4) {
                        item = item.substr(0, 3);
                        if (item === 'Tag') {
                            if (tempArray.length >= 1) {
                                tempArray.push(list[j]);
                                var titleOBject = {title: "", Tags: ""};
                                titleOBject.title = tempArray[0];
                                titleOBject.Tags = tempArray[1];
                                filterArray.push(titleOBject);
                                tempArray.clear();
                            }


                            continue;
                        }
                        item = list[j];
                        item = item.substr(0, 4);
                        if (item === 'Titl') {
                            tempArray.push(list[j]);

                            continue;
                        }
                    }

                }
                itemArray.clear();
                for (var k = 0; k < filterArray.length; k++) {
                    if (filterArray[k].title !== undefined) {
                        itemArray.push(filterArray[k]);

                    }


                }
                filterArray.clear();

                list.sort();
                for (var i = 0; i < itemArray.length; i++) {
                    var aisleTitleCatelement = document.getElementById('titleID');

                    var title = itemArray[i].title.split(":")[1];
                    aisleTitleCatelement.options[aisleTitleCatelement.options.length] = new Option(title, title, false, false);

                }
                $("#titleID").multiselect({
                    multiple: false,
                    header: "Aisle Title",
                    noneSelectedText: "Aisle Title",
                    selectedList: 1
                }).multiselectfilter();
            }
            //read words from csv
            function ajaxcallToReadWordsList(pathOfFileToReadFrom, list) {
                var datatype = '';

                var ajax = $.ajax({
                    url: pathOfFileToReadFrom,
                    async: true,
                    success: function(csvd) {
                        //console.log('ajax succes: ' + csvd);
                        datatype = $.csv2Array(csvd);
                        //console.log('ajax arry: ' + datatype);

                    },
                    dataType: "text",
                });

                ajax.complete(function(jqXHR) {
                    // console.log('ajax complete ' + datatype);
                    if (jqXHR.readyState === 4) {
                        readWords(datatype, list);
                    }
                });
            }
            function readWords(array, list) {
                for (var i = 0; i < array.length; i++) {
                    var tmp = array[i];
                    var line = tmp;
                    for (var j = 0; j < line.length; j++) {
                        v = line[j];
                        v = $.trim(v);
                        if (v !== '' && v.length > 0) {
                            var word = v.split(":")[0];
                            list.push(word);
                        }
                    }
                }
            }
        </script>






    </head>

    <body onLoad="getTags()">
        <div id="header"><h4>Create Aisle By Selecting one of the below options</h4></div>
        <table id="product">

        </table>  
        <p>Option 1:</p>
        <select id="productType_tag" onchange="productTypeTag()" name="selection" multiple="multiple" style="width:150;"   ></select>
        &nbsp &nbsp <input type="text" placeHolder="Enter filter word(optional)" id="filter_word_opt1" autoComplete="mygroup1"/> 
        <script language="javascript" type="text/javascript">
            autoComplete.Set("mygroup1", allTags);</script>
        &nbsp &nbsp <input type='button' id="fetch_button_id_opt1" value='Fetch with ProductType'   onClick="getProductWithProductType()"/> 
        <p>Option 2:</p>
        <select id="Occassion_tag" onchange="occasionSelectionVal()" name="selection" multiple="multiple"   style="width: 200px" >
        </select>  &nbsp &nbsp   
        <select id="occasionProductType" onchange="occasionProduct_Type()" name="selection" multiple="multiple" style="width:150;"   >
        </select> &nbsp &nbsp
        <input type="text" placeHolder="Enter filter word(optional)" id="filter_word_opt2" autoComplete="mygroup2"/>
        <script language="javascript" type="text/javascript">
            autoComplete.Set("mygroup2", allTags);</script>
        &nbsp &nbsp     <input type='button' id="fetch_button_op2" value='Fetch with Occasion' style="margin-left: 5px;"   onClick="fetchProductWithOccasion()"/> 
        <p>Option 3:</p>    <select id="titleID"   onchange="onTitleSelectionChange()" name="selection"    multiple="multiple" style="width: 150px"  >
        </select> &nbsp &nbsp   
        <select id="title_ProductType" onchange="titleProduct_Type()" name="selection" multiple="multiple" style="width:150px;"   >
        </select> &nbsp &nbsp
        <input type="text" placeHolder="Enter filter word(optional)" id="filter_word_opt3" autoComplete="mygroup3" />
        <script language="javascript" type="text/javascript">
            autoComplete.Set("mygroup3", allTags);
        </script>
        <input type='button' id="fetch_button_id" value='Fetch with Title' onClick="getProductsWithTitle()" align="left"/> 

        <button class="link" id="btTagOne" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagTwo" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagThree" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagFour" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagFive" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagSix" onclick="titleTag(this)"> </button>
        <button class="link" id="btTagSeven" onclick="titleTag(this)"> </button>
        <p align="center"  style="font-size:16px"> <b id="tag_id"> </b> </p>
        <hr>


        <input type='button' id="fetch_more_button_id" value='Fetch More' onClick="fetchMore()"  style="margin-left:30em;"
               />  &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  &nbsp &nbsp &nbsp &nbsp<img src='images/bx_loader.gif' id="gif_id"/> 

        <br>
        <!--        <div class="outside">
        
                    <p id='btnPrevious' style="margin-left:30em;"><span id="slider-prev"></span> | <span id="slider-next"></span></p>
        
        
        
                    <p id='btnNext'  style="margin-right:30em;"><span id="slider-prev2"></span> | <span id="slider-next2"></span></p>
                </div>-->


        <table align="center"  style="border-spacing: 20px;"><tr>
                <td  > <p id='products_text_id'> Select products from here</p>  

                    <div  id = 'products_holder_id' class="slider6">
                        <div> <img src ='images/aisle_bagroundvue.jpg' /></div>

                    </div>  

                </td> 

                <td  >
                    <div>
                        <div class="outside"><p id='products_id'> Selected Products:</p> 

                            <input type='button' id='submit_button' value='Submit Aisle' onClick="onSubmitAisleButtonClick()"/> 
                        </div> 


                        <div id='aisle_holder_id' class="slider8">
                            <div> <img src ='images/aislebg.jpg'  /></div>
                        </div>

                    </div>

                </td>
                <!--<td width = 600 id='product_info_id'>
                
                
                                </td> -->

            </tr>
        </table>
        <script>


            $(document).ready(function() {
                document.getElementById("titleID").style.marginLeft = "50px";
                document.getElementById("fetch_button_id").style.marginLeft = "50px";
                document.getElementById("fetch_button_id").style.marginRight = "50px";
                // ajaxcallToPType('OccasionsCuration.csv', titleTags);


            });
            var aisleSlider;
            $(document).ready(function() {

                aisleSlider = $('.slider8').bxSlider({
                    slideWidth: 400,
                    adaptiveHeight: true,
                    infiniteLoop: false
                });
            });
            var slider;

            $(document).ready(function() {
                slider = $('.slider6').bxSlider({
                    slideWidth: 400,
                    adaptiveHeight: true,
                    infiniteLoop: false
                });
            });

            function aisleSldierReload() {
                aisleSlider.reloadSlider({
                    slideWidth: 400,
                    adaptiveHeight: true,
                    infiniteLoop: false
                });
            }

            function sliderReload() {
                //e.preventDefault();
                slider.reloadSlider({
                    slideWidth: 400,
                    adaptiveHeight: true,
                    infiniteLoop: false
                });
            }
            function movePorductsSlider(postion) {
                slider.goToSlide(postion);
            }
            function moveAisleSlider(postion) {
                aisleSlider.goToSlide(postion);
            }
            function changeButton(isAisleReadyToUpload, count) {
                if (isAisleReadyToUpload) {
                    window.top.postMessage('aislePost#Ready#' + count, '*');
                } else {
                    window.top.postMessage('aislePost#NotReady#' + count, '*');
                }
            }
            function onSubmitAisleButtonClick() {
                aisleCount = aisleCount + 1;
                ga('send', 'event', 'button', 'click', 'Submit Aisle', aisleCount);
                uploadProductCount = 0;
                getSelectedProducts();
                if(selectedProducts.length !== 0){
                createAisleRequest();
            }
            }

        </script>
    </body>


</html>

<style>
    #or_id {


        margin-right: 20px;
        margin-left: 20px;
    }
    button.link { background:none;border:none; }
    .outside{
        text-align:center;
    }

    #btnPrevious
    {
        float:left;
    }
    #btnNext
    {
        float:right;
    }
    #products_id
    {
        float:left;
    }

    .test{
        display:inline-block;
    }


    .center {
        margin: auto;

    }
    .container{
        width:500px;
        height:550px;
        padding:20px;
        border:1px solid gray;
        -webkit-box-sizing:border-box;
        -moz-box-sizing:border-box;
        box-sizing:border-box;
        background: white;	
    }
    .slider_wrapper{
        overflow: hidden;
        position:relative;
        height:500px;
        top:auto;
    }

    .nvgt{
        position:absolute;
        top: 120px;
        height: 50px;
        width: 30px;
        opacity: 0.6;
    }
    .nvgt:hover{
        opacity: 0.9;
    }
    input.largerCheckbox
    {
        width: 30px;
        height: 30px;
    }
    label{width:150px; display:inline-block}
    input[type="checkbox"]:checked+label{background:green; color:white}​

    .myButtonRED {
        -moz-box-shadow: inset 0px 39px 0px -24px #e67a73;
        -webkit-box-shadow: inset 0px 39px 0px -24px #e67a73;
        box-shadow: inset 0px 39px 0px -24px #e67a73;
        background-color: #e4685d;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 4px;
        border: 1px solid #ffffff;
        display: inline-block;
        cursor: pointer;
        color: #ffffff;
        font-family: arial;
        font-size: 15px;
        padding: 6px 15px;
        text-decoration: none;
        text-shadow: 0px 1px 0px #b23e35;
    }
    .pos_fixed {
        position: fixed;
        top: 30px;
        right: 150px;

    }

    hr {
        display: block;
        height: 1px;
        border: 0;
        border-top: 1px solid #ccc;
        margin: 1em 0;
        padding: 0;
    }
    .multiselect {
        width:20em;
        height:15em;
        border:solid 1px #c0c0c0;
        overflow:auto;
    }

    .multiselect label {
        display:block;
    }

    .multiselect-on {
        color:#ffffff;
        background-color:#000099;
    }
    #header {
        background-color:white;
        color:black;
        text-align:center;
        padding:4px;
        box-shadow: 2px 2px 2px 1px #aaaaaa;
    }
</style>

